<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/modules/update.js | Buffer for Node Documentation API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="git+ssh://git@github.com/joemckie/buffer-node.git">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div data-ice="classWrap">
  <h2>Class</h2>
  <ul>
    
  <li data-ice="classDoc"><span><a href="class/src/client.js~BufferClient.html">BufferClient</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/modules/profile.js~Profile.html">Profile</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/modules/update.js~Update.html">Update</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/utils.js~Utils.html">Utils</a></span></li>
</ul>
</div>










</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/modules/update.js</h1>
<pre class="source-code line-number"><code class="prettyprint linenums" data-ice="content">import utils from &apos;../utils&apos;;
import Promise from &apos;promise&apos;;

export default class Update {
	constructor (update) {
		this.promise = new Promise((resolve, reject) =&gt; {
			if (typeof(update) === &apos;string&apos;) {
				// Instantiating the update from an ID
				this.getByID(update, function (err, res) {
					resolve(res);
				});
			} else {
				// Instantiating the update from an object
				resolve(update);
			}
		}).then((update) =&gt; {
			// Map the update to this object
			utils.mapObject(this, update);
		});
	}

	/**
	 * Retrieves a singular update with a given ID
	 * @param  {Integer}  update_id - The ID of the update to retrieve
	 * @param  {Function} callback  - The callback to run when the request has been fulfilled
	 */
	getByID (update_id, callback) {
		_bufferAPI.get(`updates/${update_id}.json`, callback);
	}

	/**
	 * Updates the current status update on the API, then modifies the object to match the edit
	 * @param  {Object}   params   - The parameters to update
	 * @param  {Function} callback - The callback to run when the request has been fulfilled
	 */
	edit (params, callback) {
		this.promise.then(() =&gt; {
			_bufferAPI.post(`updates/${this.id}/update.json`, {
				text:         params.text         || this.text,
				now:          params.now          || this.now,
				media:        params.media        || this.media,
				utc:          params.utc          || false,
				scheduled_at: params.scheduled_at || this.scheduled_at
			}, (err, res) =&gt; {
				if (!err) {
					utils.mapObject(this, res.update);
				}

				callback(err, res);
			});
		});
	}

	/**
	 * Saves a status update to the user&apos;s buffer
	 * @param  {Function} callback - The callback to run when the request has been fulfilled
	 */
	save (callback = function () {}) {
		this.promise.then(() =&gt; {
			_bufferAPI.post(&apos;updates/create.json&apos;, {
				profile_ids:  this.profile_ids,
				text:         this.text,
				shorten:      this.shorten,
				now:          this.now,
				top:          this.top,
				media:        this.media,
				attachment:   this.attachment,
				scheduled_at: this.scheduled_at
			}, (err, res) =&gt; {
				if (!err &amp;&amp; res.updates) {
					utils.mapObject(this, res.updates[0]);
				}

				callback(err, res);
			});
		});
	}

	/**
	 * Deletes a status update from the user&apos;s buffer
	 * @param  {Function} callback - The callback to run when the request has been fulfilled
	 */
	destroy (callback = function () {}) {
		this.promise.then(() =&gt; {
			_bufferAPI.post(`updates/${this.id}/destroy.json`, (err, res) =&gt; {
				if (!err) {
					// TODO:
					// There&apos;s probably a better way of doing this...
					// Ideally it wants to be scrubbed from the profile it&apos;s assigned to,
					// and the instance destroyed
					this.destroyed = true;
				}

				callback(err, res);
			});
		});
	}

	/**
	 * Instantly shares an update to the selected account
	 * @param  {Function} callback - The callback to run when the request has been fulfilled
	 */
	share (callback = function () {}) {
		_bufferAPI.post(`updates/${this.id}/share.json`, (err, res) =&gt; {
			if (!err) {
				// The update object will have changed upon sharing, so map it
				this.getByID(this.id, (err, res) =&gt; {
					if (!err) {
						utils.mapObject(this, res);
						callback(err, res);
					}
				});
			}
		});
	}

	/**
	 * Gets interactions (e.g. retweets) from an update with a given ID
	 * @param  {Object}   params   - A list of params to be appended to the URL.
	 * @param  {Function} callback - The callback to run when the request has been fulfilled
	 */
	getInteractions (event, params, callback) {
		_bufferAPI.post(`updates/${this.id}/interactions.json`, {
			event: event,
			page:  params.page  || null,
			count: params.count || null
		}, callback);
	}

	/**
	 * Moves the current update to the top of the Buffer queue
	 * @param  {Function} callback - The callback to run when the request has been fulfilled
	 */
	moveToTop (callback) {
		_bufferAPI.post(`updates/${this.id}/move_to_top.json`, callback);
	}
}</code></pre>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.1.4)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
